var module={};module.getIntent=function(t){function a(t,a,r,e,s,i){this.speech=t,this.action=a,this.people=r,this.devices=e||[],this.time=s,this.timeString=i}function r(t){if(this.rawString=(t||"").toLowerCase(),this.RELATIVE=["last","next","this"],this.WEEKDAYS=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],this.DAYS=["today","tomorrow"],this.AP=["a.m.","p.m.","am","pm"],t.match(/\snow/))return Date.create("now");t=t.replace(/a\.m\./gi,"am").replace(/p\.m\./gi,"pm").replace(/\,\s*|\.\s*/gi,"").replace(/(on)\s*(?=monday|tuesday|wednesday|thursday|friday|saturday|sunday)/gi," this ").replace(/(this)\s*(?:morning|afternoon|evening)/gi,"today");var a=/(\d+\:*\d*)\s*(?=o'clock|am|pm|\D*(?:morning|afternoon)|\D*(?:today|tomorrow|after\s*tomorrow)|(?:this|next)\s+(?:monday|tuesday|wednesday|thursday|friday|saturday|sunday))|(?:\D*(?:morning|afternoon)|\D*(?:today|tomorrow|after\s*tomorrow)|(?:this|next)\s+(?:monday|tuesday|wednesday|thursday|friday|saturday|sunday))\s*(?:at|)\s*(\d+\:*\d*)\s*(?:am|pm|o\'clock|\s)|(?:at)\s*(\d+\:*\d*)|(\d+\:\d+)/gi,r=/(am|pm|a\.m\.|p\.m\.|morning|afternoon|evening)/gi,e=/(?:today|tomorrow|after\s*tomorrow)|(?:this|next)\s+(?:monday|tuesday|wednesday|thursday|friday|saturday|sunday)/gi,s=((t.match(a)||[]).first()||"now").replace(/[a-z]*/gi,"").compact();if(!isNaN(parseInt(s))&&parseInt(s)>100){var i=s.length;s=s.slice(0,i-2)+":"+s.slice(i-2)}var n=function(t){if(t+="","now"!==t){if(t.startsWith("6")||t.startsWith("7")||t.startsWith("8")||t.startsWith("9")||t.startsWith("10")||t.startsWith("11"))return"am";if(t.startsWith("12")||t.startsWith("1")||t.startsWith("2")||t.startsWith("3")||t.startsWith("4")||t.startsWith("5"))return"pm"}return""},o=((t.match(r)||[]).first()||n(s)).compact(),d=((t.match(e)||[]).first()||"today").compact(),c=s+" "+o+" "+d;return console.log(c,"matchedString"),"today"==c.trim()&&(c="now"),Date.create(c)}function e(t){this.rawString=(t||"").toLowerCase()}function s(t){this.rawString=(t||"").toLowerCase(),this.DEVICES=["projector","whiteboard","phone","lcd","camera","speaker","catering"]}function i(t,a){this.rawString=t||"",this.words=a||[]}if("undefined"!=typeof require){require("sugar")}return e.prototype.search=function(){var t=new RegExp("\\s*(largest|biggest|large|small|big|huge)|(\\d+)\\s*(?=people|guys*)\\s*|(?:for|with)\\s+(\\d+)\\s*","gi"),a=this.rawString.match(t),r={large:20,small:5,big:20,largest:200,biggest:200,huge:200},e=function(t){var a=t||[];for(var r in a){var e=a[r].match(/\d+/gi);if(!isNaN(parseInt(e)))return e+""}return a.first()+""};return a=e(a).compact(),isNaN(parseInt(a))&&(a=r[a]),a=parseInt(a),isNaN(a)&&(a=5),this.rawString=this.rawString.replace(t,""),{matched:a,rawString:this.rawString}},s.prototype.search=function(){var t=this.rawString.split(" ");return t=t.map(function(t){var a=t.remove(/\,/g);return a}),t.intersect(this.DEVICES)},i.prototype.getIntent=function(){var t=this.rawString.toLowerCase();this.words=t.split(" ");var i=new a(t);-1!==this.words.indexOf("book")&&(i.action="book"),i.action=i.action||"book",i.devices=new s(t).search();var n=new e(t).search();return i.people=n.matched,t=n.rawString,i.time=new r(t),i.timeString=i.time.format("{12hr}:{mm} {tt} on {Weekday} {Month} {dd}"),i},new i(t).getIntent()},module.getRoom=function(t){if("book"===t.action){{var a={capacity:99999};Room.MeetingRooms}for(i in Room.MeetingRooms){var r=Room.MeetingRooms[i];parseInt(r.capacity)>=parseInt(t.people)&&r.capacity<=a.capacity&&(a=r)}return a}};
$(document).ready(function(){var n=function(){return"undefined"!=typeof speechRecognition?new speechRecognition:"undefined"!=typeof msSpeechRecognition?new msSpeechRecognition:"undefined"!=typeof mozSpeechRecognition?new mozSpeechRecognition:"undefined"!=typeof webkitSpeechRecognition?new webkitSpeechRecognition:(console.error("no SpeechRecognition supported!"),{})},e=n();e.continuous=!0,e.interimResults=!0,e.lang="en-GB";var o=!0;$(document).on("confirming",function(){o=!1}).on("yes",function(){o=!0,t="",i=""});var i="",t="";e.onresult=function(n){i="";for(var e=n.resultIndex;e<n.results.length;e++)n.results[e].isFinal?(t+=n.results[e][0].transcript,console.log("onresult - finalTranscript: "+t)):(i+=n.results[e][0].transcript,console.log("onresult - interimTranscript: "+i));t.length>0&&(o&&$("#what-i-say").val(t),"yes"===t.trim().toLowerCase()&&$(document).trigger("yes"),t="",console.log("onresult - recognizing: "+c))},e.onstart=function(){$(".wrapper").addClass("recording")},e.onend=function(){c=!1,console.log("onend - recognizing: "+c),$(".wrapper").removeClass("recording")};var c=!1;$("#what-i-say, .mic-icon").on("click",function(){c?(e.stop(),c=!1,console.log("onclick - recognizing: "+c)):(e.start(),c=!0,console.log("onclick - recognizing: "+c))})});
var Room={};Room.MeetingRooms=[{name:"Weyrich",floor:2,capacity:30},{name:"Executive",floor:1,capacity:50},{name:"AC",floor:2,capacity:20},{name:"ADS",floor:2,capacity:10},{name:"General",floor:1,capacity:200},{name:"Ad hoc 1",floor:1,capacity:5},{name:"Ad hoc 2",floor:1,capacity:5}];
$(document).ready(function(){function e(){$("#what-i-have ul").empty();for(i in Room.MeetingRooms){var e=Room.MeetingRooms[i];$("#what-i-have ul").append('<li data-id="room-{name}"><img src="assets/room_{name}.jpg" /><span>{title}, on {floor} floor, capacity: {capacity}</span></li>'.assign({name:e.name.dasherize(),title:e.name,floor:1==parseInt(e.floor)?"1st":"2nd",capacity:e.capacity}))}}function t(){$("#what-i-think section").each(function(){""===$(this).find("p").text().trim()?$(this).addClass("hidden"):$(this).removeClass("hidden")})}function o(e){$wit=$("#what-i-think");var t=!1;for(k in e){var i=(e[k]+"").trim(),o=(s[k]+"").trim();i!=o&&(console.log(i+"---"+o),$wit.find("#"+k+" p").html(i).effect("bounce","slow"),t=!0)}t&&n(e)}function n(e){if(!r){var t="You want to {action} a meeting room {timeString} for {people} participants with {devices}. ".assign({action:e.action,timeString:e.timeString,people:e.people,devices:0==(e.devices||[]).length?"no special device":e.devices.join(", ")}),i=new SpeechSynthesisUtterance(t),o=new SpeechSynthesisUtterance("Is this correct?");$(document).trigger("confirming"),window.speechSynthesis.speak(i),setTimeout(function(){window.speechSynthesis.speak(o)},500),l=e,r=!0,setTimeout(function(){r=!1},1e4)}}var a=module.getIntent,s={},c="";$("#what-i-say").focus(),e(),t(),setInterval(function(){var e=$("#what-i-say").val();if(e!=c){h();var i=a(e.endsWith(" ")?e:e+" ");o(i),s=i,c=e;var n=module.getRoom(i),r="room-"+(n.name||"").dasherize();$('#what-i-have li:not([data-id="'+r+'"])').hide(),$('#what-i-have li[data-id="'+r+'"]').show(),console.log(n),console.log("updated HMI"),t()}},500);var h=function(){window.setTimeout(function(){console.log("scrollHeight: "+$("#what-i-say").prop("scrollHeight")+"px"),$("#what-i-say").css("height","auto"),$("#what-i-say").css("height",$("#what-i-say").prop("scrollHeight")+"px")},0)};$("#what-i-say").on("keyup",h),$(window).on("resize",h);var r=!1,l=null;$(document).on("yes",function(e){console.log(e,"yes");var t=new SpeechSynthesisUtterance("OK, let me look it up. ");window.speechSynthesis.speak(t)})});